services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend.lite
    environment:
      # 精简版默认关闭不必要的重量功能，可按需调整
      CORS_ALLOW_ORIGIN: "http://localhost:5173"
      ENABLE_WEB_SEARCH: "false"
      BYPASS_EMBEDDING_AND_RETRIEVAL: "true"
      ENABLE_OLLAMA_API: "false"
      HTTP_PROXY: "http://host.docker.internal:7890"
      HTTPS_PROXY: "http://host.docker.internal:7890"
      NO_PROXY: "localhost,127.0.0.1,172.0.0.0/8,.docker.internal"
    ports:
      - "8080:8080"
    volumes:
      # 持久化数据库和配置文件，防止容器重建后数据丢失
      - ./data:/app/backend/data

  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend.lite
    depends_on:
      - backend
    environment:
      APP_BUILD_HASH: "docker-lite"
    ports:
      - "5173:5173"
